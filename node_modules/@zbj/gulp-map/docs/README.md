Gulp Map帮助文档
============

DEMO
---------

本demo用于演示:
1. 创建实例
2. 在less文件处创建索引
3. 在gulp结束时创建索引文件

``` javascript
const GulpMap = require('@jlgl/gulp-map');
const less = require('gulp-less');
const hash = require('gulp-hash');
const gulp = require('gulp');
// 创建map实例
const map = new GulpMap({
    uri: 'http://localhost',
    namespace: 'test'
});
gulp.task('less', function(cb){
    gulp.src('./build/css/*.less')
    .pipe(map.savePath({
        replace: 'less',
        to: 'css'
    }))
    .pipe(less())
    .pipe(gulp.dest('./build/css'))
    .on('end', cb);
})

gulp.task('build', ['less'], function() {
    gulp.src('./build/**/*.{css,html,js,png,gif,jpg}')
    .pipe(hash())
    .pipe(map.savePath({
        hash: true
    }))
    .pipe(gulp.dest('./dist/'))
    .on('finish', function(){
        map.buildMap('./dist/');
    });
});
```

API
---------

### GulpMap(opts)

创建一个map实例
#### opts 选项
- `uri`: 资源地址前缀,如`http://localhost`,默认为空
- `namespace`: 命名空间,默认为空
    - 为空时,在map.json中以'${resoucePath}'的形式作为key值
    - 如果不为空,在map.json中以'${namespace}:${resoucePath}'的形式作为key值

### savePath(opts)
在当前实例中保存一个map键值
#### opts 选项
- `replace`: 替换的后缀名,如`less`,默认为空
- `to`: 替换的目标后缀名,如`css`,默认为空
- `hash`: 如果使用了`gulp-hash`,则需要设置为`true`,默认为`false`

> `replace`和`to`两个参数必须同时设置

当以上两个参数设置时,map.json中以如下形式生成:
- `source`:标识map.json中目标的key
- `type`:源文件的后缀的类型

```json
{
    "test:/css/style.less":{
        "source": "test:/css/style.css",
        "type": "less"
    }
}
```

当以上两个参数为空时,map.json中以如下形式生成:
- `uri`: 资源地址,如果创建实例时设置了`uri`,则在该处体现
- `type`:源文件的后缀的类型

```json
{
    "test:/index.html":{
        "uri": "http://localhost/index.html",
        "type": "html"
    }
}
```

### getMap
获取当前实例的map对象

### buildMap(buildDir)
用于生成当前实例的map.json索引

- `buildDir`: 构建的目录地址,相对于当前项目根目录,必填