'use strict';
const component = require('../');
const gulp = require('gulp');
const fs = require('fs');
const del = require('del');
const assert = require('power-assert');

function getFileContent(distPath) {
    return fs.readFileSync(distPath).toString();
}

describe('Map File', function() {
    after(function(done) {
        del(['./test/dist'])
        .then(function() {
            done();
        })
        .catch(done);
    });
    describe('Build', function() {
        it('Build gulp task', function(done) {
            gulp.src('./test/build/**/*')
            .pipe(component())
            .pipe(gulp.dest('./test/dist/'))
            .on('finish', function() {
                done();
            });
        });
        it('Build gulp task with namespace', function(done) {
            gulp.src('./test/build/layout/*')
            .pipe(component({
                namespace: 'test'
            }))
            .pipe(gulp.dest('./test/dist/namespace/'))
            .on('finish', function() {
                done();
            });
        });
    });
    describe('Confirm File', function() {
        it('Confirm empty_resource/', function() {
            assert(getFileContent('./test/dist/empty_resource/index.html') === getFileContent('./test/valid/empty_resource/index.html'));
        });
        it('Confirm layout/', function() {
            assert(getFileContent('./test/dist/layout/index.html') === getFileContent('./test/valid/layout/index.html'));
        });
        it('Confirm single_resource_css/', function() {
            assert(getFileContent('./test/dist/single_resource_css/index.html') === getFileContent('./test/valid/single_resource_css/index.html'));
        });
        it('Confirm single_resource_js/', function() {
            assert(getFileContent('./test/dist/single_resource_js/index.html') === getFileContent('./test/valid/single_resource_js/index.html'));
        });
        it('Confirm without_layout/', function() {
            assert(getFileContent('./test/dist/without_layout/index.html') === getFileContent('./test/valid/without_layout/index.html'));
        });
        it('Confirm namespace/', function() {
            assert(getFileContent('./test/dist/namespace/index.html') === getFileContent('./test/valid/namespace/index.html'));
        });
    });
});