'use strict';
const through = require('through2');
const libMod = require('./lib/');

function buildFile(options) {
    const config = Object.assign({
        namespace: '', //命名空间
        tplSuffix: '.html', //模板后缀
        cssSuffix: '.css', //css后缀
        scriptSuffix: '.js', //script后缀
        insertName: 'mapUse', //插入的helper名
    }, options);
    return through.obj(function(file, encoding, callback) {
        // 如果是文件夹则跳过
        if(!file.isDirectory()) {
            const fileNames = libMod.getComponentFileNames(file, config);
            if(!fileNames) return callback(null, file);
            let content = file.contents.toString(encoding);
            content = libMod.insertFiles(content, fileNames, config);
            file.contents = Buffer.from(content);
        }
        callback(null, file);
    });
}
module.exports = buildFile;