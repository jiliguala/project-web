'use strict';
const lessImport = require('../');
const gulp = require('gulp');
const fs = require('fs');
const del = require('del');
const path = require('path');
const assert = require('power-assert');

function getFileContent(distPath) {
    return fs.readFileSync(distPath).toString();
}

describe('Build File', function() {
    after(function(done) {
        del(['./test/dist'])
            .then(function() {
                done();
            })
            .catch(done);
    });
    describe('Build', function() {
        it('Build gulp task', function(done) {
            gulp.src(['./test/build/**/*', '!./test/build/**/_*.less'])
                .pipe(lessImport({
                    path: path.join(__dirname, 'build/_common.less')
                }))
                .pipe(gulp.dest('./test/dist/'))
                .on('finish', function() {
                    done();
                });
        });
    });
    describe('Confirm File', function() {
        it('Confirm same_dir/', function() {
            assert(getFileContent('./test/dist/same_dir.less') === getFileContent('./test/valid/same_dir.less'));
        });
        it('Confirm page/already_import.less', function() {
            assert(getFileContent('./test/dist/page/already_import.less') === getFileContent('./test/valid/page/already_import.less'));
        });
        it('Confirm page/index.less', function() {
            assert(getFileContent('./test/dist/page/index.less') === getFileContent('./test/valid/page/index.less'));
        });
    });
});