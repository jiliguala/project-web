'use strict';
const through = require('through2');
const libMod = require('./lib/');

function buildFile(options) {
    const config = Object.assign({
        path: '' //公共less文件地址
    }, options);
    if(!config.path) {
        throw new Error('You must set "path" with path.join');
    }
    return through.obj(function(file, encoding, callback) {
        // 如果是文件夹则跳过
        if(!file.isDirectory()) {
            const content = libMod.importLess(file, encoding, config);
            // 兼容老buffer API
            if(Buffer.from) {
                file.contents = Buffer.from(content);
            }else {
                file.contents = new Buffer(content);
            }
        }
        callback(null, file);
    });
}
module.exports = buildFile;