'use strict';
const seajs = require('../');
const gulp = require('gulp');
const fs = require('fs');
const del = require('del');
const assert = require('power-assert');

function getFileContent(distPath) {
    return fs.readFileSync(distPath).toString();
}

describe('Map File', function() {
    after(function(done) {
        del(['./test/dist'])
        .then(function() {
            done();
        })
        .catch(done);
    });
    describe('Build', function() {
        it('Build gulp task', function(done) {
            gulp.src('./test/build/src/*.js')
            .pipe(seajs())
            .pipe(gulp.dest('./test/dist/'))
            .on('finish', function() {
                done();
            });
        });
        it('Build gulp task with namespace', function(done) {
            gulp.src('./test/build/src/namespace/**')
            .pipe(seajs({
                namespace: 'test'
            }))
            .pipe(gulp.dest('./test/dist/namespace/'))
            .on('finish', function() {
                done();
            });
        });
    });
    describe('Confirm File', function() {
        it('Confirm all.js', function() {
            assert(getFileContent('./test/dist/all.js') === getFileContent('./test/valid/all.js'));
        });
        it('Confirm without_tpl.js', function() {
            assert(getFileContent('./test/dist/without_tpl.js') === getFileContent('./test/valid/without_tpl.js'));
        });
        it('Confirm exports.js', function() {
            assert(getFileContent('./test/dist/exports.js') === getFileContent('./test/valid/exports.js'));
        });
        it('Confirm module_exports.js', function() {
            assert(getFileContent('./test/dist/module_exports.js') === getFileContent('./test/valid/module_exports.js'));
        });
        it('Confirm normal_js.js', function() {
            assert(getFileContent('./test/dist/normal_js.js') === getFileContent('./test/valid/normal_js.js'));
        });
        it('Confirm /namespace/simple.js', function() {
            assert(getFileContent('./test/dist//namespace/simple.js') === getFileContent('./test/valid//namespace/simple.js'));
        });
    });
});